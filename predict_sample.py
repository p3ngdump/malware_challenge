import init
import pandas as pd
import numpy as np
from train_model import *
from glob import glob

csv_path = ""

def label_check(hash):
    with open(csv_path, 'r') as reader:
        for line in reader:
            fields = line.strip().split(',')
            if fields[0].startswith(hash):
                return fields[1]

if __name__ == '__main__':
    lgbm_model = lgb.Booster(model_file=model_path)
    files = glob("folder_path\*.vir'")

    for i in range(len(files)):
        # if i %100==0 :
        #    print(i)

        mal_data = open(files[i], 'rb').read()
        predict = init.predict_sample(lgbm_model, mal_data, files[i])
        print(files[i], ":", predict)
        sha256 = files[i].split('.')[0].split('\\')[-1]
        score = np.int32(predict > 0.70)
        data = sha256 + ", " + str(score) + "\x0a"
